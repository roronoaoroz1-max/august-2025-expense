<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Expense Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f0f4f8, #a1d6e2);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 30px;
    }

    .container {
      background: #ffffff;
      border-radius: 16px;
      padding: 40px;
      width: 100%;
      max-width: 900px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
    }

    .container:hover {
      transform: translateY(-5px);
    }

    h1 {
      text-align: center;
      color: #004d40;
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 20px;
      letter-spacing: 1.2px;
    }

    label {
      font-weight: 600;
      color: #00695c;
      margin-top: 15px;
      display: block;
      font-size: 1.1rem;
    }

    input, button {
      width: 100%;
      padding: 14px;
      margin: 10px 0 20px;
      border-radius: 10px;
      border: 1px solid #b2dfdb;
      font-size: 1rem;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    input:focus, select:focus {
      border-color: #004d40;
      box-shadow: 0 0 6px rgba(0, 77, 64, 0.3);
      outline: none;
    }

    button {
      font-weight: 600;
      cursor: pointer;
      border: none;
      outline: none;
      border-radius: 10px;
      transition: background-color 0.3s ease;
    }

    .cash-in-btn {
      background: #4caf50;
      color: #fff;
    }
    .cash-in-btn.active, .cash-in-btn:hover { background: #388e3c; }

    .cash-out-btn {
      background: #e53935;
      color: #fff;
    }
    .cash-out-btn.active, .cash-out-btn:hover { background: #c62828; }

    .csv-btn {
      background: #0288d1;
      color: #fff;
      padding: 10px;
      font-size: 0.9rem;
      margin-top: 15px;
    }
    .csv-btn:hover { background: #0277bd; }
    .csv-btn:active { background: #01579b; }

    .button-container {
      display: flex;
      gap: 15px;
    }

    .amount-container {
      display: flex;
      gap: 15px;
    }
    .amount-container > div { flex: 1; }

    .summary {
      margin: 20px 0;
      background: #e0f2f1;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    .summary h3 {
      color: #00695c;
      margin-bottom: 15px;
      font-size: 1.5rem;
    }
    .summary p {
      font-size: 1.2rem;
      margin: 8px 0;
    }
    .balance-positive {
      color: #4caf50;
      font-weight: bold;
    }
    .balance-negative {
      color: #e53935;
      font-weight: bold;
    }

    .transaction-list h3 {
      color: #00695c;
      margin-top: 40px;
      font-size: 1.5rem;
    }
    .transaction-item {
      background: #e6f3f3;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .accordion {
      background-color: #00796b;
      color: white;
      cursor: pointer;
      padding: 14px;
      width: 100%;
      text-align: left;
      border: none;
      outline: none;
      font-size: 1.1rem;
      border-radius: 10px;
      font-weight: 600;
    }

    .accordion:hover {
      background-color: #005f56;
    }

    .category-list {
      display: none;
      padding: 15px 20px;
      background: #f5fafa;
      border-radius: 8px;
      margin-top: 10px;
    }

    .category-item {
      padding: 10px;
      background: #b2dfdb;
      border-radius: 6px;
      margin-bottom: 8px;
      cursor: pointer;
      font-size: 1rem;
    }

    .category-item:hover {
      background: #80deea;
    }

    .accordion.active + .category-list {
      display: block;
    }

    .radio-container {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
    }

    .radio-container label {
      font-size: 1rem;
    }

    .button-group {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      margin-top: 10px;
    }

    .delete-btn, .edit-btn {
      padding: 8px 16px;
      font-weight: 600;
      border-radius: 8px;
      font-size: 0.9rem;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .delete-btn {
      background-color: #e53935;
      color: white;
    }

    .edit-btn {
      background-color: #ff9800;
      color: white;
    }

    .delete-btn:hover {
      background-color: #c62828;
    }

    .delete-btn:active {
      background-color: #b71c1c;
    }

    .edit-btn:hover {
      background-color: #e65100;
    }

    .edit-btn:active {
      background-color: #bf360c;
    }

    @media (max-width: 600px) {
      .amount-container, .button-container {
        flex-direction: column;
      }
      .button-group {
        flex-direction: row;
        justify-content: flex-end;
      }
      .container {
        padding: 20px;
      }
      h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Expense Tracker</h1>
    <div class="summary">
      <h3>Summary for August</h3>
      <div id="summaryDisplay"></div>
      <button type="button" id="downloadCsvButton" class="csv-btn">Download CSV Report</button>
    </div>
    <form id="transactionForm">
      <label for="date">Date</label>
      <input type="date" id="date" required value="2025-08-01" />

      <label for="remark">Remark</label>
      <input type="text" id="remark" placeholder="Groceries, Salary..." required />

      <div id="categoryAccordionContainer">
        <button type="button" class="accordion">Select Category</button>
        <div id="categoryList" class="category-list"></div>
      </div>
      <button type="button" id="addCategoryButton">+ Add New Category</button>

      <div class="radio-container">
        <button type="button" id="cashInButton" class="cash-in-btn">Cash In</button>
        <button type="button" id="cashOutButton" class="cash-out-btn">Cash Out</button>
      </div>

      <div class="amount-container">
        <div>
          <label for="amount">Amount</label>
          <input type="number" id="amount" placeholder="Enter amount" required />
        </div>
        <div>
          <label for="balance">Balance</label>
          <input type="text" id="balance" disabled placeholder="Balance" />
        </div>
      </div>

      <button type="submit" id="submitTransaction">Add Transaction</button>
    </form>

    <div class="transaction-list">
      <h3>Transactions</h3>
      <div id="transactionList"></div>
    </div>
  </div>

  <script>
    const categories = [
      "Salary", "Grocery", "Food", "Health", "Coffee", "Travel", 
      "Self Care", "Gas", "Medianet", "Fuel", "Phone Bill", "Wifi", 
      "Repair", "Trust Fund", "Gift/Inward", "Gift/Outward", "Stelco", 
      "MWSC", "Giveaway", "Rent", "Last Month Borrowing", "Repaid loan"
    ];

    let transactions = [];
    let balance = 0;
    let currentType = 'Cash In';

    function selectCategory(category) {
      const categoryButton = document.querySelector('.accordion');
      categoryButton.textContent = category;
     categoryButton.classList.remove('active');

    }

    document.querySelector('.accordion').addEventListener('click', function() {
  this.classList.toggle('active');
    });

    function populateCategories() {
      const categoryList = document.getElementById('categoryList');
      categoryList.innerHTML = '';
      categories.forEach(category => {
        const categoryItem = document.createElement('div');
        categoryItem.classList.add('category-item');
        categoryItem.textContent = category;
        categoryItem.addEventListener('click', () => selectCategory(category));
        categoryList.appendChild(categoryItem);
      });
    }

    document.getElementById('addCategoryButton').addEventListener('click', function() {
      const newCategory = prompt("Enter a new category:");
      if (newCategory) {
        categories.push(newCategory);
        populateCategories();
      }
    });

    const GOOGLE_SHEET_API_URL = "https://script.google.com/macros/s/AKfycbzfIURYPr1ZMBlY8v-Bu5sv8TX5mIfyQib5nWzm_PaWGxNH6olCOtCsqpYNOZg5joY/exec";

document.getElementById('submitTransaction').addEventListener('click', function(event) {
  event.preventDefault();

    const date = document.getElementById('date').value;
      const remark = document.getElementById('remark').value;
      const category = document.querySelector('.accordion').textContent;
      const amount = parseFloat(document.getElementById('amount').value);

      if (!category || !remark || !amount || !currentType || category === 'Select Category') {
        alert("Please fill in all fields and select a valid category and transaction type!");
        return;
      }

     if (currentType === 'Cash In') {
        balance += amount;
      } else {
        balance -= amount;
      }

        const transactions = {
        date,
        remark,
        category,
        amount,
        type: currentType,
        balance
      };

   transactions.push(transaction);
  document.getElementById('balance').value = balance.toFixed(2);
  displayTransactions();
  updateSummary();
  
  // Send to Google Sheets
  fetch(GOOGLE_SHEET_API_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(transaction)
  }).then(() => {
    console.log('Transaction sent to Google Sheets');
  }).catch((error) => {
    console.error('Failed to send transaction to Google Sheets:', error);
  });

  //Reset
  document.getElementById('transactionForm').reset();
  document.querySelector('.accordion').textContent = 'Select Category';
  document.querySelector('.cash-in-btn').classList.remove('active');
  document.querySelector('.cash-out-btn').classList.remove('active');
    });    
    
 document.getElementById('cashInButton').addEventListener('click', function() {
      currentType = 'Cash In';
      document.querySelector('.cash-in-btn').classList.add('active');
      document.querySelector('.cash-out-btn').classList.remove('active');
    });

    document.getElementById('cashOutButton').addEventListener('click', function() {
      currentType = 'Cash Out';
      document.querySelector('.cash-out-btn').classList.add('active');
      document.querySelector('.cash-in-btn').classList.remove('active');
    });
    
    document.getElementById('balance').value = balance.toFixed(2);
      displayTransactions();
      updateSummary();

     

   

    function updateSummary() {
      const summaryDisplay = document.getElementById('summaryDisplay');
      const balanceClass = balance >= 0 ? 'balance-positive' : 'balance-negative';
      summaryDisplay.innerHTML = `
        <p>Total Balance: <span class="${balanceClass}">${balance.toFixed(2)}</span></p>
      `;
    }

    function generateCsv() {
      const headers = ['Date', 'Remark', 'Category', 'Amount', 'Type', 'Balance'];
      const csvRows = [headers.join(',')];

      transactions.forEach(transaction => {
        const row = [
          transaction.date,
          `"${transaction.remark.replace(/"/g, '""')}"`,
          `"${transaction.category.replace(/"/g, '""')}"`,
          transaction.amount.toFixed(2),
          transaction.type,
          transaction.balance.toFixed(2)
        ];
        csvRows.push(row.join(','));
      });

      const csvContent = csvRows.join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', `transactions_${new Date().toISOString().split('T')[0]}.csv`);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    document.getElementById('downloadCsvButton').addEventListener('click', generateCsv);

    function displayTransactions() {
      const transactionList = document.getElementById('transactionList');
      transactionList.innerHTML = '';

      transactions.forEach((transaction, index) => {
        const transactionItem = document.createElement('div');
        transactionItem.classList.add('transaction-item');

        const accordion = document.createElement('button');
        accordion.classList.add('accordion');
        accordion.textContent = `${transaction.date} - ${transaction.category} - ${transaction.amount} (${transaction.type})`;

        const transactionDetails = document.createElement('div');
        transactionDetails.classList.add('category-list');
        transactionDetails.innerHTML = `
          <p>Remark: ${transaction.remark}</p>
          <p>Balance: ${transaction.balance.toFixed(2)}</p>
        `;

        const buttonGroup = document.createElement('div');
        buttonGroup.classList.add('button-group');

        const deleteBtn = document.createElement('button');
        deleteBtn.classList.add('delete-btn');
        deleteBtn.textContent = 'X';
        deleteBtn.addEventListener('click', function() {
          const confirmDelete = confirm("Are you sure you want to delete this transaction?");
          if (confirmDelete) {
            transactions.splice(index, 1);
            displayTransactions();
            updateBalance();
            updateSummary();
          }
        });

        const editBtn = document.createElement('button');
        editBtn.classList.add('edit-btn');
        editBtn.textContent = 'Edit';
        editBtn.addEventListener('click', function() {
          const newAmount = prompt("Enter new amount:", transaction.amount);
          const newCategory = prompt("Enter new category:", transaction.category);
          const newRemark = prompt("Enter new remark:", transaction.remark);
          const newDate = prompt("Enter new date (YYYY-MM-DD):", transaction.date);

          if (newAmount !== null && newCategory !== null && newRemark !== null && newDate !== null) {
            transaction.amount = parseFloat(newAmount);
            transaction.category = newCategory;
            transaction.remark = newRemark;
            transaction.date = newDate;

            updateBalance();
            displayTransactions();
            updateSummary();
          }
        });

        accordion.addEventListener('click', function() {
          this.classList.toggle('active');
          transactionDetails.style.display = this.classList.contains('active') ? 'block' : 'none';
        });

        buttonGroup.appendChild(editBtn);
        buttonGroup.appendChild(deleteBtn);
        transactionItem.appendChild(accordion);
        transactionItem.appendChild(transactionDetails);
        transactionItem.appendChild(buttonGroup);
        transactionList.appendChild(transactionItem);
      });
    }

    function updateBalance() {
      balance = 0;
      transactions.forEach(transaction => {
        if (transaction.type === 'Cash In') {
          balance += transaction.amount;
        } else {
          balance -= transaction.amount;
        }
        transaction.balance = balance;
      });

      document.getElementById('balance').value = balance.toFixed(2);
    }

    populateCategories();
    updateSummary();
  </script>
</body>
</html>
